{% load static %}
{% load search_extra %}
{% load crispy_forms_tags %}

<html lang="en">
<head>

	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
	
	<link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
	<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<!------ Include the above in your HEAD tag ---------->

	<title>Scatter Chart</title>
	<script src={% static "js/chart.js" %}></script>
	<script src={% static "js/chart_utils.js" %}></script>

	<link rel="stylesheet" href="{% static 'css/page_theme.css' %}">
	<style src={% static "css/page_theme.css" %}></style>

	<style>
		canvas {
			-moz-user-select: none;
			-webkit-user-select: none;
			-ms-user-select: none;
		}
	</style>


</head>
<body>
	{% comment %} background below {% endcomment %}
	<nav class="navbar navbar-expand navbar-dark bg-primary"> <a href="#menu-toggle" id="menu-toggle" class="navbar-brand"><span class="navbar-toggler-icon"></span></a> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExample02" aria-controls="navbarsExample02" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button>
		<div class="collapse navbar-collapse" id="navbarsExample02">
			<ul class="navbar-nav mr-auto">
				<li class="nav-item active"> <a class="nav-link" href="{% url 'zipf'%}">Home <span class="sr-only">(current)</span></a> </li>
			</ul>
			<form class="form-inline my-2 my-md-0"> </form>
		</div>
	</nav>
	<div id="wrapper" class="toggled">
		<!-- Sidebar -->
		<div id="sidebar-wrapper">
			<ul class="sidebar-nav">
				<li> <a>_</a> </li>
				<li> <button type="button" id="origin" class="btn btn-outline-secondary">Original</button> </li>
				<li> <a>_</a> </li>
				<li> <button type="button" id="stemming" class="btn btn-outline-secondary">Stemming</button> </li>
				<li> <a>_</a> </li>
			</ul>
		</div> <!-- /#sidebar-wrapper -->
		<!-- Page Content -->
		{% comment %} Make sure to keep all page content within the #page-content-wrapper {% endcomment %}
		<div id="page-content-wrapper">
			{% comment %} search bar {% endcomment %}
			<form action="{% url "zipf_search" %}" method="post">
				{% csrf_token %}
				{% crispy form %}
				{% comment %} <input type="submit" value="submit"> {% endcomment %}
			</form>
			{% comment %} end search_bar {% endcomment %}
			<div class="container-fluid">
				<h1>{{ char_title }}</h1>
				{% comment %} chart below {% endcomment %}
				<div style="width:75%">
					<canvas id="canvas"></canvas>
				</div>
				<button id="show_all" class="btn btn-outline-primary">Show All</button>
				<script>
					var color = Chart.helpers.color;
					var top_freq = {{ top_freq|escapejs}}
					var other_freq = {{ other_freq|escapejs }}
					var top_freq_raw = {{ top_freq_raw|escapejs}}
					var other_freq_raw = {{ other_freq_raw|escapejs }}

					{% comment %} generate Stem data {% endcomment %}
					function getDataSet() {
						var dataset = [];
						for (var i = 0; i < 100 ; i++){
							dataset.push({label: i,
										backgroundColor: getRandomColor(),
										data: generateData(i)})
						}
						
						dataset.push({label: "other",
							backgroundColor: getRandomColor(),
							data: generateOtherData() })
						return dataset;
					}

					function generateData(par) {
						var data = [];
						
						data.push({
							x: par,
							y: top_freq[par]
						});
						
						return data;
					}
					
					function generateOtherData() {
						var data = [];
						
						for (var i = 0; i < 1000; i++){
							data.push({
								x: i+100,
								y: other_freq[i]
							});
						}
						return data;
						
					}
					
					{% comment %} generate origin data {% endcomment %}
					function getOriginDataSet() {
						var dataset = [];
						for (var i = 0; i < 100 ; i++){
							dataset.push({label: i,
										backgroundColor: getRandomColor(),
										data: generateDataOrigin(i)})
						}
						
						dataset.push({label: "other",
							backgroundColor: getRandomColor(),
							data: generateOtherDataOrigin() })
						return dataset;
					}

					function generateDataOrigin(par) {
						var data = [];
						
						data.push({
							x: par,
							y: top_freq_raw[par]
						});
						
						return data;
					}
					
					function generateOtherDataOrigin() {
						var data = [];
						
						for (var i = 0; i < 1000; i++){
							data.push({
								x: i+100,
								y: other_freq_raw[i]
							});
						}
						return data;
						
					}
					
					function getRandomColor() {
						var letters = '0123456789ABCDEF'.split('');
						var color = '#';
						for (var i = 0; i < 6; i++ ) {
							color += letters[Math.floor(Math.random() * 16)];
						}
						return color;
					}
					

					var scatterChartData = {
						datasets : getDataSet(),
					};

					var scatterChartDataOrigin = {
						datasets : getOriginDataSet(),
					};

					window.onload = function() {
						var ctx = document.getElementById('canvas').getContext('2d');
						window.myScatter = Chart.Scatter(ctx, {
							data: scatterChartData,
							options: {
								title: {
									display: true,
									text: "Zipf Chart after stemming"
								},
							}
						});
					};

					document.getElementById('origin').addEventListener('click', function() {
						var ctx = document.getElementById('canvas').getContext('2d');
						window.myScatter = Chart.Scatter(ctx, {
							data: scatterChartDataOrigin,
							options: {
								title: {
									display: true,
									text: "Zipf Chart before stemming",
								},
							}
						});
						window.myScatter.update();
					});

					document.getElementById('stemming').addEventListener('click', function() {
						var ctx = document.getElementById('canvas').getContext('2d');
						window.myScatter = Chart.Scatter(ctx, {
							data: scatterChartData,
							options: {
								title: {
									display: true,
									text: "Zipf Chart after stemming",
								},
							}
						});
						window.myScatter.update();
					});
				</script>
				{% comment %} chart above {% endcomment %}

				{% comment %} table below {% endcomment %}
				<table class="table">
					<thead>
						<tr>
						<th scope="col">Frequency after stemming</th>
						<th scope="col">Stem Word</th>
						<th scope="col">#</th>
						<th scope="col">Origin Frequency</th>
						<th scope="col">Origin Word</th>
						<th scope="col">#</th>
						</tr>
					</thead>
					<tbody>
						{% for i in top_words_raw %}
						<tr>
						<th scope="row">{{ top_freq|get_element:forloop.counter0 }}</th>
							<td>{{ top_words|get_element:forloop.counter0 }}</td>
							<td>{{ forloop.counter }}</td>
							<td>{{ top_freq_raw|get_element:forloop.counter0 }}</td>
							<td>{{ i }}</td>
							<td>{{ forloop.counter }}</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
				{% comment %} table above {% endcomment %}
			</div>
			{% comment %} search result {% endcomment %}
			<div class="list-group">
				{% for i in titles_name %}
					<a href="#" class="list-group-item list-group-item-action flex-column align-items-start">
						<div class="d-flex w-100 justify-content-between">
						<small class="text-muted">{{ titles_freq|get_element:forloop.counter0 }} matched</small>
						<h5 class="mb-1">{{ i|remove_period }}</h5>
						</div>
						{% comment %} <p class="mb-1">Donec id elit non mi porta gravida at eget metus. Maecenas sed diam eget risus varius blandit.</p>
						<small class="text-muted">Donec id elit non mi porta.</small> {% endcomment %}
					</a>
				{% endfor %}
			</div>
	{% comment %} end search result {% endcomment %}
		</div> <!-- /#page-content-wrapper -->
	</div> <!-- /#wrapper -->

	<!-- Bootstrap core JavaScript -->
	<script src="js/jquery.min.js"></script>
	<script src="js/bootstrap.bundle.min.js"></script> <!-- Menu Toggle Script -->
	<script>
		$(function(){
		$("#menu-toggle").click(function(e) {
			e.preventDefault();
			$("#wrapper").toggleClass("toggled");
		});

		$(window).resize(function(e) {
			if($(window).width()<=768){
			$("#wrapper").removeClass("toggled");
			}else{
			$("#wrapper").addClass("toggled");
			}
		});
		});
		
	</script>
	{% comment %} background above {% endcomment %}

</body>
</html>
